---
title: "Machine Learning Course Project"
author: "Erik Johnson"
date: "November 21, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Synopsis
```{r libraries,message=FALSE}
library(caret)
```

```{r readdata}
rawData <- read.csv("pml-training.csv")
dim(training)
```

```{r cleandata}
# Look for near-zero variables
nsv <- nearZeroVar(rawData,saveMetrics=TRUE)
# Remove near-zero variables
dat <- rawData[,nsv$nzv == FALSE]
# Remove name variables
# c("X", "user_name", "raw_timestamp_part_1", "raw_timestamp_part_2", "cvtd_timestamp")
dat <- dat[,-c(1:5)]
# Get the percent of NA values for each column
colNAPercentages <- sapply(names(dat), function(colName){sum(is.na(dat[[colName]]))/nrow(dat)})
# Remove columns with almost all NA values
dat <- dat[,names(colNAPercentages[colNAPercentages < 0.97])]

# Create training and testing partitions
set.seed(32465)
inTrain <- createDataPartition(y=dat$classe, p=0.6, list=FALSE)
training <- dat[inTrain,]
validation <- dat[-inTrain,]

# Use cross-validation (5-fold) random forest to fit the model
fitRF <- train(classe ~ ., data=training, method="rf", trControl=trainControl(method="cv",5))

# Check the accuracy on the validation data
predFitRF <- predict(fitRF, validation)
confusionMatrix(validation$classe, predFitRF)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
