---
title: "Machine Learning Course Project"
author: "Erik Johnson"
date: "November 21, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Synopsis
```{r libraries,message=FALSE}
library(caret)
```

```{r readdata}
rawData <- read.csv("pml-training.csv")
```

```{r cleandata}
# Look for near-zero variables
nsv <- nearZeroVar(rawData,saveMetrics=TRUE)
# Remove near-zero variables
dat <- rawData[,nsv$nzv == FALSE]
# Remove name variables
# c("X", "user_name", "raw_timestamp_part_1", "raw_timestamp_part_2", "cvtd_timestamp")
dat <- dat[,-c(1:5)]
# Get the percent of NA values for each column
colNAPercentages <- sapply(names(dat), function(colName){sum(is.na(dat[[colName]]))/nrow(dat)})
# Remove columns with almost all NA values
dat <- dat[,names(colNAPercentages[colNAPercentages < 0.97])]
```

```{r partitionData}
# Create training and testing partitions
set.seed(32465)
inTrain <- createDataPartition(y=dat$classe, p=0.6, list=FALSE)
training <- dat[inTrain,]
validation <- dat[-inTrain,]
```

```{r fitRF,cache=TRUE}
# Use cross-validation (5-fold) random forest to fit the model
fitRF <- train(classe ~ ., data=training, method="rf", trControl=trainControl(method="cv",10))
```

```{r fitRFCheck}
# Check the accuracy on the validation data
predFitRF <- predict(fitRF, validation)
confusionMatrix(validation$classe, predFitRF)
```

```{r fitRPart,cache=TRUE}
fitRPart <- train(classe ~ ., data=training, method="rpart")
```

```{r fitRPartCheck}
predFitRPart <- predict(fitRPart, validation)
confusionMatrix(validation$classe, predFitRPart)
```

```{r fitGBM,cache=TRUE}
fitGBM <- train(classe ~ ., data=training, method="gbm", verbose=FALSE)
```

```{r fitGBMCheck}
predFitGBM <- predict(fitGBM, validation)
confusionMatrix(validation$classe, predFitGBM)
```

```{r fitNB,cache=TRUE}
fitNB <- train(classe ~ ., data=training, method="nb")
```

```{r fitNBCheck}
predFitNB <- predict(fitNB, validation)
confusionMatrix(validation$classe, predFitNB)
```

```{r fitLDA,cache=TRUE}
fitLDA <- train(classe ~ ., data=training, method="lda")
```

```{r fitLDACheck}
predFitLDA <- predict(fitLDA, validation)
confusionMatrix(validation$classe, predFitLDA)
```

```{r combineModels}
predDF <- data.frame(predFitRF, predFitRPart, predFitGBM, predFitNB, predFitLDA, classe = validation$classe)
```

```{r fitCombined,cache=TRUE}
fitCombined <- train(classe ~ ., data=predDF, method="rf", trControl=trainControl(method="cv",10))
fitCombined
```

```{r majorityVote}
# Select only models that attained accuracy > .75
# RF, GBM, NB
majorityVote <- function(currentRow) {
    result <- as.integer(names(which.max(sort(table(c(predDF$predFitRF[currentRow], predDF$predFitGBM[currentRow], predDF$predFitNB[currentRow])), decreasing=TRUE)))[1])
    result
}
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
